var FB_Actions_Field=function(){function e(){this.init_btn_class=".fb_action_edit_init",this.init_btn=document.querySelector(this.init_btn_class),this.modal=document.querySelector("#fb_repeater_actions_modal"),this.initiator_repeater=null,this.values={},this.init()}var t=e.prototype;return t.init=function(){this.canRun()&&this.initEvents()},t.initEvents=function(){this.modal.addEventListener("fpf_modal_open",function(e){this.onPopupOpen(e)}.bind(this)),this.modal.addEventListener("fpf_modal_close",function(e){this.onPopupClose(e)}.bind(this)),this.modal.addEventListener("fpf_modal_save",function(e){this.onPopupSaveAndClose(e)}.bind(this)),document.addEventListener("fpf_repeater_add",function(e){this.onRepeaterItemAdd(e)}.bind(this)),document.addEventListener("input",function(e){this.onPopupInputChanges(e)}.bind(this)),document.addEventListener("keyup",function(e){this.onPopupInputChanges(e)}.bind(this))},t.canRun=function(){return!!this.init_btn},t.onRepeaterItemAdd=function(e){"actions"==e.detail.repeater_name&&(e.detail.repeater_item.classList.add("hide"),e.detail.repeater_item.querySelector(".fb_action_edit_init").click())},t.onPopupInputChanges=function(e){var t;e.target.closest("#fb_repeater_actions_modal")&&(t=e.target.getAttribute("name"),this.values[t]={value:e.target.value},"checkbox"==e.target.type&&(e.target.parentElement.classList.contains("fptoggle")?(this.values[t].value=e.target.previousElementSibling.hasAttribute("name")?0:1,this.values[t].checked=!e.target.previousElementSibling.hasAttribute("name")):this.values[t].checked=e.target.checked))},t.onPopupOpen=function(e){var t,i,n,a,r,o;"fb_repeater_actions_modal"==e.detail.modal_name&&null==this.initiator_repeater&&((t=this.modal.querySelector(".modal-content .modal-body")).innerHTML="",n=(i=e.detail.initiator.closest(".fpf-repeater-item")).querySelector(".fpf-repeater-item-label-input").value,r=(a=(this.initiator_repeater=i).querySelector(".fb-repeater-item-action-settings")).cloneNode(!0),o=a.cloneNode(!0),a.innerHTML=o,this.preparePopupSettings(n,r),t.innerHTML=r.innerHTML.replace(/data-showon-initialised/g,""),"function"==typeof FPF_Textarea&&new FPF_Textarea(t).init(),new FPF_Conditionize(t))},t.preparePopupSettings=function(e,t){var i=t.querySelectorAll(".fpf-run-condition");i&&i.forEach(function(e){e.classList.remove("fpf-run-condition"),e.style.display="none"}),t.querySelector(".fpf-repeater-item-modal-title").value=e,t.querySelector(".fpf-repeater-item-modal-title").setAttribute("value",e)},t.onPopupClose=function(e){var t;"fb_repeater_actions_modal"==e.detail.modal_name&&this.initiator_repeater&&(t=e.target.closest(".modal").querySelector(".modal-body").cloneNode(!0),this.initiator_repeater.querySelector(".fb-repeater-item-action-settings").innerHTML=t.innerHTML,(this.initiator_repeater.repeater_data&&this.initiator_repeater.repeater_data.initial_open||this.initiator_repeater.classList.contains("hide"))&&this.initiator_repeater.remove(),this.initiator_repeater=null,this.values={})},t.onPopupSaveAndClose=function(e){if("fb_repeater_actions_modal"==e.detail.modal_name&&this.initiator_repeater){var t=e.target.closest(".modal").querySelector(".modal-body").cloneNode(!0);if(this.values)for(var i in this.values){var n=this.values[i],a=this.initiator_repeater.querySelector('[name="'+i+'"]');a&&this.setElemValue(a,n);var r=t.querySelector('[name="'+i+'"]');r&&this.setElemValue(r,n)}this.initiator_repeater.querySelector(".fb-repeater-item-action-settings").innerHTML=t.innerHTML,this.initiator_repeater.repeater_data&&this.initiator_repeater.repeater_data.initial_open&&(this.initiator_repeater.repeater_data.initial_open=!1,this.initiator_repeater.classList.remove("hide")),this.initiator_repeater=null,this.values={}}},t.setElemValue=function(e,t){if("select-one"==e.type?e.options[e.selectedIndex].removeAttribute("selected"):"hidden"==e.type&&e.nextElementSibling&&"checkbox"==e.nextElementSibling.type?e.nextElementSibling.removeAttribute("checked"):"textarea"==e.type?(e.value=t.value,e.innerHTML=t.value):(e.setAttribute("value",t.value),e.value=t.value),"select-one"==e.type)for(var i=0;i<e.options.length;++i)e.options[i].value===t.value&&e.options[i].setAttribute("selected",!0);t.checked&&e.setAttribute("checked",t.checked)},e}();document.addEventListener("DOMContentLoaded",function(){new FB_Actions_Field});

